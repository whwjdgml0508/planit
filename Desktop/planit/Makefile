# PlanIt í”„ë¡œì íŠ¸ Makefile
# ìì£¼ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´ë“¤ì„ ê°„í¸í•˜ê²Œ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

.PHONY: help install dev test clean build deploy docker-build docker-up docker-down screenshots ssl

# ê¸°ë³¸ ë„ì›€ë§
help:
	@echo "ğŸš€ PlanIt í”„ë¡œì íŠ¸ ëª…ë ¹ì–´"
	@echo ""
	@echo "ê°œë°œ í™˜ê²½:"
	@echo "  install     - ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜"
	@echo "  dev         - ê°œë°œ ì„œë²„ ì‹¤í–‰"
	@echo "  test        - í…ŒìŠ¤íŠ¸ ì‹¤í–‰"
	@echo "  clean       - ìºì‹œ ë° ì„ì‹œ íŒŒì¼ ì •ë¦¬"
	@echo ""
	@echo "ë°°í¬:"
	@echo "  build       - í”„ë¡œë•ì…˜ ë¹Œë“œ"
	@echo "  deploy      - EC2 ë°°í¬"
	@echo ""
	@echo "Docker:"
	@echo "  docker-build - Docker ì´ë¯¸ì§€ ë¹Œë“œ"
	@echo "  docker-up   - Docker ì»¨í…Œì´ë„ˆ ì‹œì‘"
	@echo "  docker-down - Docker ì»¨í…Œì´ë„ˆ ì¤‘ì§€"
	@echo ""
	@echo "ìœ í‹¸ë¦¬í‹°:"
	@echo "  screenshots - ìë™ ìŠ¤í¬ë¦°ìƒ· ì´¬ì˜"
	@echo "  ssl         - SSL ì¸ì¦ì„œ ì„¤ì •"

# ê°œë°œ í™˜ê²½ ì„¤ì •
install:
	@echo "ğŸ“¦ ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì¤‘..."
	pip install -r requirements.txt
	python manage.py migrate
	@echo "âœ… ì„¤ì¹˜ ì™„ë£Œ!"

# ê°œë°œ ì„œë²„ ì‹¤í–‰
dev:
	@echo "ğŸš€ ê°œë°œ ì„œë²„ ì‹œì‘ ì¤‘..."
	python manage.py runserver

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
test:
	@echo "ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
	python manage.py test

# ì •ë¦¬
clean:
	@echo "ğŸ§¹ ì •ë¦¬ ì¤‘..."
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	rm -rf .pytest_cache
	rm -rf .coverage
	@echo "âœ… ì •ë¦¬ ì™„ë£Œ!"

# í”„ë¡œë•ì…˜ ë¹Œë“œ
build:
	@echo "ğŸ—ï¸ í”„ë¡œë•ì…˜ ë¹Œë“œ ì¤‘..."
	python manage.py collectstatic --noinput
	@echo "âœ… ë¹Œë“œ ì™„ë£Œ!"

# EC2 ë°°í¬
deploy:
	@echo "ğŸš€ EC2 ë°°í¬ ì¤‘..."
	chmod +x deploy/simple-deploy.sh
	./deploy/simple-deploy.sh

# Docker ì´ë¯¸ì§€ ë¹Œë“œ
docker-build:
	@echo "ğŸ³ Docker ì´ë¯¸ì§€ ë¹Œë“œ ì¤‘..."
	docker-compose build

# Docker ì»¨í…Œì´ë„ˆ ì‹œì‘ (ê°œë°œìš©)
docker-up:
	@echo "ğŸ³ Docker ì»¨í…Œì´ë„ˆ ì‹œì‘ ì¤‘..."
	docker-compose up -d

# Docker ì»¨í…Œì´ë„ˆ ì‹œì‘ (í”„ë¡œë•ì…˜ìš©)
docker-up-prod:
	@echo "ğŸ³ í”„ë¡œë•ì…˜ Docker ì»¨í…Œì´ë„ˆ ì‹œì‘ ì¤‘..."
	docker-compose -f docker-compose.prod.yml up -d

# Docker ì»¨í…Œì´ë„ˆ ì¤‘ì§€
docker-down:
	@echo "ğŸ³ Docker ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ì¤‘..."
	docker-compose down

# í”„ë¡œë•ì…˜ Docker ì»¨í…Œì´ë„ˆ ì¤‘ì§€
docker-down-prod:
	@echo "ğŸ³ í”„ë¡œë•ì…˜ Docker ì»¨í…Œì´ë„ˆ ì¤‘ì§€ ì¤‘..."
	docker-compose -f docker-compose.prod.yml down

# ìë™ ìŠ¤í¬ë¦°ìƒ· ì´¬ì˜
screenshots:
	@echo "ğŸ“¸ ìŠ¤í¬ë¦°ìƒ· ì´¬ì˜ ì¤‘..."
	python take_screenshots.py

# SSL ì¸ì¦ì„œ ì„¤ì •
ssl:
	@echo "ğŸ”’ SSL ì¸ì¦ì„œ ì„¤ì • ì¤‘..."
	chmod +x deploy/setup_ssl.sh
	./deploy/setup_ssl.sh

# ë¡œê·¸ í™•ì¸
logs:
	@echo "ğŸ“‹ ë¡œê·¸ í™•ì¸ ì¤‘..."
	docker-compose logs -f

# í”„ë¡œë•ì…˜ ë¡œê·¸ í™•ì¸
logs-prod:
	@echo "ğŸ“‹ í”„ë¡œë•ì…˜ ë¡œê·¸ í™•ì¸ ì¤‘..."
	docker-compose -f docker-compose.prod.yml logs -f

# ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
backup:
	@echo "ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ì¤‘..."
	python manage.py dumpdata > backup_$(shell date +%Y%m%d_%H%M%S).json

# ë§ˆì´ê·¸ë ˆì´ì…˜
migrate:
	@echo "ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰ ì¤‘..."
	python manage.py makemigrations
	python manage.py migrate

# ìŠˆí¼ìœ ì € ìƒì„±
superuser:
	@echo "ğŸ‘¤ ìŠˆí¼ìœ ì € ìƒì„± ì¤‘..."
	python manage.py createsuperuser

# ì •ì  íŒŒì¼ ìˆ˜ì§‘
collectstatic:
	@echo "ğŸ“ ì •ì  íŒŒì¼ ìˆ˜ì§‘ ì¤‘..."
	python manage.py collectstatic --noinput
